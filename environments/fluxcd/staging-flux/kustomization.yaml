apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- deployment.yaml

namespace: staging-flux

labels:
- pairs:
    environment: staging-flux
    gitops-tool: fluxcd

replicas:
- count: 3
  name: windows-aspnet-app

images:
- name: acrdemoeastus2001.azurecr.io/windows-aspnet
  newTag: 02bff8b5b0787d7e83706c77178dfe0dcaf12d7e

patchesStrategicMerge:
- |-
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: windows-aspnet-app
    namespace: staging-flux
  spec:
    template:
      spec:
        containers:
        - name: aspnet-app
          env:
          - name: ENVIRONMENT_NAME
            value: "staging-flux"
          - name: DEPLOYMENT_METHOD  
            value: "FluxCD GitOps"